{"version":3,"sources":["../../../../nodes/Airtop/actions/router.ts"],"sourcesContent":["import type { IExecuteFunctions, INodeExecutionData } from 'n8n-workflow';\nimport { NodeOperationError } from 'n8n-workflow';\n\nimport { cleanOutputForToolUse } from './common/output.utils';\nimport * as extraction from './extraction/Extraction.resource';\nimport * as file from './file/File.resource';\nimport * as interaction from './interaction/Interaction.resource';\nimport type { AirtopType } from './node.type';\nimport * as session from './session/Session.resource';\nimport * as window from './window/Window.resource';\nimport type { IAirtopNodeExecutionData } from '../transport/types';\n\nexport async function router(this: IExecuteFunctions): Promise<INodeExecutionData[][]> {\n\tconst operationResult: INodeExecutionData[] = [];\n\tlet responseData: IAirtopNodeExecutionData[] = [];\n\tconst nodeType = this.getNode().type;\n\tconst isCalledAsTool = nodeType.includes('airtopTool');\n\n\tconst items = this.getInputData();\n\tconst resource = this.getNodeParameter<AirtopType>('resource', 0);\n\tconst operation = this.getNodeParameter('operation', 0);\n\n\tconst airtopNodeData = {\n\t\tresource,\n\t\toperation,\n\t} as AirtopType;\n\n\tfor (let i = 0; i < items.length; i++) {\n\t\ttry {\n\t\t\tswitch (airtopNodeData.resource) {\n\t\t\t\tcase 'session':\n\t\t\t\t\tresponseData = await session[airtopNodeData.operation].execute.call(this, i);\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'window':\n\t\t\t\t\tresponseData = await window[airtopNodeData.operation].execute.call(this, i);\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'interaction':\n\t\t\t\t\tresponseData = await interaction[airtopNodeData.operation].execute.call(this, i);\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'extraction':\n\t\t\t\t\tresponseData = await extraction[airtopNodeData.operation].execute.call(this, i);\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'file':\n\t\t\t\t\tresponseData = await file[airtopNodeData.operation].execute.call(this, i);\n\t\t\t\t\tbreak;\n\t\t\t\tdefault:\n\t\t\t\t\tthrow new NodeOperationError(\n\t\t\t\t\t\tthis.getNode(),\n\t\t\t\t\t\t`The resource \"${resource}\" is not supported!`,\n\t\t\t\t\t);\n\t\t\t}\n\n\t\t\t// Get cleaner output when called as tool\n\t\t\tif (isCalledAsTool && !['session', 'window'].includes(resource)) {\n\t\t\t\tresponseData = cleanOutputForToolUse(responseData);\n\t\t\t}\n\n\t\t\tconst executionData = this.helpers.constructExecutionMetaData(responseData, {\n\t\t\t\titemData: { item: i },\n\t\t\t});\n\n\t\t\toperationResult.push(...executionData);\n\t\t} catch (error) {\n\t\t\tif (this.continueOnFail()) {\n\t\t\t\toperationResult.push({\n\t\t\t\t\tjson: this.getInputData(i)[0].json,\n\t\t\t\t\terror: error as NodeOperationError,\n\t\t\t\t});\n\t\t\t} else {\n\t\t\t\tthrow error;\n\t\t\t}\n\t\t}\n\t}\n\n\treturn [operationResult];\n}\n"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;AAAA;AAAA;AAAA;AAAA;AAAA;AACA,0BAAmC;AAEnC,oBAAsC;AACtC,iBAA4B;AAC5B,WAAsB;AACtB,kBAA6B;AAE7B,cAAyB;AACzB,aAAwB;AAGxB,eAAsB,SAAiE;AACtF,QAAM,kBAAwC,CAAC;AAC/C,MAAI,eAA2C,CAAC;AAChD,QAAM,WAAW,KAAK,QAAQ,EAAE;AAChC,QAAM,iBAAiB,SAAS,SAAS,YAAY;AAErD,QAAM,QAAQ,KAAK,aAAa;AAChC,QAAM,WAAW,KAAK,iBAA6B,YAAY,CAAC;AAChE,QAAM,YAAY,KAAK,iBAAiB,aAAa,CAAC;AAEtD,QAAM,iBAAiB;AAAA,IACtB;AAAA,IACA;AAAA,EACD;AAEA,WAAS,IAAI,GAAG,IAAI,MAAM,QAAQ,KAAK;AACtC,QAAI;AACH,cAAQ,eAAe,UAAU;AAAA,QAChC,KAAK;AACJ,yBAAe,MAAM,QAAQ,eAAe,SAAS,EAAE,QAAQ,KAAK,MAAM,CAAC;AAC3E;AAAA,QACD,KAAK;AACJ,yBAAe,MAAM,OAAO,eAAe,SAAS,EAAE,QAAQ,KAAK,MAAM,CAAC;AAC1E;AAAA,QACD,KAAK;AACJ,yBAAe,MAAM,YAAY,eAAe,SAAS,EAAE,QAAQ,KAAK,MAAM,CAAC;AAC/E;AAAA,QACD,KAAK;AACJ,yBAAe,MAAM,WAAW,eAAe,SAAS,EAAE,QAAQ,KAAK,MAAM,CAAC;AAC9E;AAAA,QACD,KAAK;AACJ,yBAAe,MAAM,KAAK,eAAe,SAAS,EAAE,QAAQ,KAAK,MAAM,CAAC;AACxE;AAAA,QACD;AACC,gBAAM,IAAI;AAAA,YACT,KAAK,QAAQ;AAAA,YACb,iBAAiB,QAAQ;AAAA,UAC1B;AAAA,MACF;AAGA,UAAI,kBAAkB,CAAC,CAAC,WAAW,QAAQ,EAAE,SAAS,QAAQ,GAAG;AAChE,2BAAe,qCAAsB,YAAY;AAAA,MAClD;AAEA,YAAM,gBAAgB,KAAK,QAAQ,2BAA2B,cAAc;AAAA,QAC3E,UAAU,EAAE,MAAM,EAAE;AAAA,MACrB,CAAC;AAED,sBAAgB,KAAK,GAAG,aAAa;AAAA,IACtC,SAAS,OAAO;AACf,UAAI,KAAK,eAAe,GAAG;AAC1B,wBAAgB,KAAK;AAAA,UACpB,MAAM,KAAK,aAAa,CAAC,EAAE,CAAC,EAAE;AAAA,UAC9B;AAAA,QACD,CAAC;AAAA,MACF,OAAO;AACN,cAAM;AAAA,MACP;AAAA,IACD;AAAA,EACD;AAEA,SAAO,CAAC,eAAe;AACxB;","names":[]}