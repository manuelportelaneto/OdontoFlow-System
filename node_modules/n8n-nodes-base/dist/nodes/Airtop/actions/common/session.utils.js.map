{"version":3,"sources":["../../../../../nodes/Airtop/actions/common/session.utils.ts"],"sourcesContent":["import type { IExecuteFunctions, IDataObject } from 'n8n-workflow';\n\nimport {\n\tvalidateSessionAndWindowId,\n\tcreateSessionAndWindow,\n\tshouldCreateNewSession,\n\tvalidateAirtopApiResponse,\n} from '../../GenericFunctions';\nimport { apiRequest } from '../../transport';\nimport type { IAirtopResponse } from '../../transport/types';\n\n/**\n * Execute the node operation. Creates and terminates a new session if needed.\n * @param this - The execution context\n * @param index - The index of the node\n * @param request - The request to execute\n * @returns The response from the request\n */\nexport async function executeRequestWithSessionManagement(\n\tthis: IExecuteFunctions,\n\tindex: number,\n\trequest: {\n\t\tmethod: 'POST' | 'DELETE';\n\t\tpath: string;\n\t\tbody: IDataObject;\n\t},\n): Promise<IAirtopResponse> {\n\tconst { sessionId, windowId } = shouldCreateNewSession.call(this, index)\n\t\t? await createSessionAndWindow.call(this, index)\n\t\t: validateSessionAndWindowId.call(this, index);\n\n\tconst shouldTerminateSession = this.getNodeParameter('autoTerminateSession', index, false);\n\n\tconst endpoint = request.path.replace('{sessionId}', sessionId).replace('{windowId}', windowId);\n\tconst response = await apiRequest.call(this, request.method, endpoint, request.body);\n\n\tvalidateAirtopApiResponse(this.getNode(), response);\n\n\tif (shouldTerminateSession) {\n\t\tawait apiRequest.call(this, 'DELETE', `/sessions/${sessionId}`);\n\t\tthis.logger.info(`[${this.getNode().name}] Session terminated.`);\n\t\treturn response;\n\t}\n\n\treturn { sessionId, windowId, ...response };\n}\n"],"mappings":";;;;;;;;;;;;;;;;;;AAAA;AAAA;AAAA;AAAA;AAAA;AAEA,8BAKO;AACP,uBAA2B;AAU3B,eAAsB,oCAErB,OACA,SAK2B;AAC3B,QAAM,EAAE,WAAW,SAAS,IAAI,+CAAuB,KAAK,MAAM,KAAK,IACpE,MAAM,+CAAuB,KAAK,MAAM,KAAK,IAC7C,mDAA2B,KAAK,MAAM,KAAK;AAE9C,QAAM,yBAAyB,KAAK,iBAAiB,wBAAwB,OAAO,KAAK;AAEzF,QAAM,WAAW,QAAQ,KAAK,QAAQ,eAAe,SAAS,EAAE,QAAQ,cAAc,QAAQ;AAC9F,QAAM,WAAW,MAAM,4BAAW,KAAK,MAAM,QAAQ,QAAQ,UAAU,QAAQ,IAAI;AAEnF,yDAA0B,KAAK,QAAQ,GAAG,QAAQ;AAElD,MAAI,wBAAwB;AAC3B,UAAM,4BAAW,KAAK,MAAM,UAAU,aAAa,SAAS,EAAE;AAC9D,SAAK,OAAO,KAAK,IAAI,KAAK,QAAQ,EAAE,IAAI,uBAAuB;AAC/D,WAAO;AAAA,EACR;AAEA,SAAO,EAAE,WAAW,UAAU,GAAG,SAAS;AAC3C;","names":[]}