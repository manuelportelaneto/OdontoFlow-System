{"version":3,"sources":["../../../../../nodes/Airtop/actions/session/create.operation.ts"],"sourcesContent":["import {\n\ttype IDataObject,\n\ttype IExecuteFunctions,\n\ttype INodeExecutionData,\n\ttype INodeProperties,\n} from 'n8n-workflow';\n\nimport { COUNTRIES } from '../../countries';\nimport {\n\tcreateSession,\n\tvalidateProfileName,\n\tvalidateProxy,\n\tvalidateSaveProfileOnTermination,\n\tvalidateTimeoutMinutes,\n} from '../../GenericFunctions';\nimport { apiRequest } from '../../transport';\nimport { profileNameField } from '../common/fields';\n\nconst displayOptions = {\n\tshow: {\n\t\tresource: ['session'],\n\t\toperation: ['create'],\n\t},\n};\n\nconst countryOptions = COUNTRIES.map(({ name, value }) => ({ name, value }));\n\nexport const description: INodeProperties[] = [\n\t{\n\t\t...profileNameField,\n\t\tdisplayOptions,\n\t},\n\t{\n\t\tdisplayName: 'Save Profile',\n\t\tname: 'saveProfileOnTermination',\n\t\ttype: 'boolean',\n\t\tdefault: false,\n\t\tdescription:\n\t\t\t'Whether to automatically save the <a href=\"https://docs.airtop.ai/guides/how-to/saving-a-profile\" target=\"_blank\">Airtop profile</a> for this session upon termination',\n\t\tdisplayOptions,\n\t},\n\t{\n\t\tdisplayName: 'Idle Timeout',\n\t\tname: 'timeoutMinutes',\n\t\ttype: 'number',\n\t\tdefault: 10,\n\t\tvalidateType: 'number',\n\t\tdescription: 'Minutes to wait before the session is terminated due to inactivity',\n\t\tdisplayOptions,\n\t},\n\t/**\n\t * Proxy Configuration\n\t */\n\t{\n\t\tdisplayName: 'Proxy',\n\t\tname: 'proxy',\n\t\ttype: 'options',\n\t\tdefault: 'none',\n\t\tdescription: 'Choose how to configure the proxy for this session',\n\t\toptions: [\n\t\t\t{\n\t\t\t\tname: 'None',\n\t\t\t\tvalue: 'none',\n\t\t\t\tdescription: 'No proxy will be used',\n\t\t\t},\n\t\t\t{\n\t\t\t\tname: 'Integrated',\n\t\t\t\tvalue: 'integrated',\n\t\t\t\tdescription: 'Use Airtop-provided proxy',\n\t\t\t},\n\t\t\t{\n\t\t\t\tname: 'Proxy URL',\n\t\t\t\tvalue: 'proxyUrl',\n\t\t\t\tdescription: 'Use a proxy URL to configure the proxy',\n\t\t\t},\n\t\t],\n\t\tdisplayOptions,\n\t},\n\t{\n\t\tdisplayName: 'Proxy Configuration',\n\t\tname: 'proxyConfig',\n\t\ttype: 'collection',\n\t\tdefault: { country: 'US', sticky: true },\n\t\tdescription: 'The Airtop-provided configuration to use for the proxy',\n\t\tplaceholder: 'Add Attribute',\n\t\toptions: [\n\t\t\t{\n\t\t\t\tdisplayName: 'Country',\n\t\t\t\tname: 'country',\n\t\t\t\ttype: 'options',\n\t\t\t\tdefault: 'US',\n\t\t\t\tdescription:\n\t\t\t\t\t'The country to use for the proxy. Not all countries are guaranteed to provide a proxy. Learn more <a href=\"https://docs.airtop.ai/api-reference/airtop-api/sessions/create#request.body.configuration.proxy.Proxy.Airtop-Proxy-Configuration.country\" target=\"_blank\">here</a>.',\n\t\t\t\toptions: countryOptions,\n\t\t\t},\n\t\t\t{\n\t\t\t\tdisplayName: 'Keep Same IP',\n\t\t\t\tname: 'sticky',\n\t\t\t\ttype: 'boolean',\n\t\t\t\tdefault: true,\n\t\t\t\tdescription:\n\t\t\t\t\t'Whether to try to maintain the same IP address for the duration of the session. Airtop can guarantee that the same IP address will be available for up to a maximum of 30 minutes.',\n\t\t\t},\n\t\t],\n\t\tdisplayOptions: {\n\t\t\tshow: {\n\t\t\t\t...displayOptions.show,\n\t\t\t\tproxy: ['integrated'],\n\t\t\t},\n\t\t},\n\t},\n\t{\n\t\tdisplayName: 'Proxy URL',\n\t\tname: 'proxyUrl',\n\t\ttype: 'string',\n\t\tdefault: '',\n\t\tdescription: 'The URL of the proxy to use',\n\t\tvalidateType: 'string',\n\t\tdisplayOptions: {\n\t\t\tshow: {\n\t\t\t\t...displayOptions.show,\n\t\t\t\tproxy: ['proxyUrl'],\n\t\t\t},\n\t\t},\n\t},\n\t{\n\t\tdisplayName: 'Additional Fields',\n\t\tname: 'additionalFields',\n\t\ttype: 'collection',\n\t\tplaceholder: 'Add Field',\n\t\tdefault: {},\n\t\tdisplayOptions,\n\t\toptions: [\n\t\t\t{\n\t\t\t\tdisplayName: 'Auto Solve Captchas',\n\t\t\t\tname: 'solveCaptcha',\n\t\t\t\ttype: 'boolean',\n\t\t\t\tdefault: false,\n\t\t\t\tdescription:\n\t\t\t\t\t'Whether to automatically solve <a href=\"https://docs.airtop.ai/guides/how-to/solving-captchas\" target=\"_blank\">captcha challenges</a>',\n\t\t\t},\n\t\t\t{\n\t\t\t\tdisplayName: 'Extension IDs',\n\t\t\t\tname: 'extensionIds',\n\t\t\t\ttype: 'string',\n\t\t\t\tdefault: '',\n\t\t\t\tplaceholder: 'e.g. extId1, extId2, ...',\n\t\t\t\tdescription:\n\t\t\t\t\t'Comma-separated extension IDs from the Google Web Store to be loaded into the session. Learn more <a href=\"https://docs.airtop.ai/guides/how-to/using-chrome-extensions\" target=\"_blank\">here</a>.',\n\t\t\t},\n\t\t],\n\t},\n];\n\nexport async function execute(\n\tthis: IExecuteFunctions,\n\tindex: number,\n): Promise<INodeExecutionData[]> {\n\tconst profileName = validateProfileName.call(this, index);\n\tconst timeoutMinutes = validateTimeoutMinutes.call(this, index);\n\tconst saveProfileOnTermination = validateSaveProfileOnTermination.call(this, index, profileName);\n\tconst { proxy } = validateProxy.call(this, index);\n\tconst solveCaptcha = this.getNodeParameter(\n\t\t'additionalFields.solveCaptcha',\n\t\tindex,\n\t\tfalse,\n\t) as boolean;\n\n\tconst extensions = this.getNodeParameter('additionalFields.extensionIds', index, '') as string;\n\tconst extensionIds = extensions ? extensions.split(',').map((id) => id.trim()) : [];\n\n\tconst body: IDataObject = {\n\t\tconfiguration: {\n\t\t\tprofileName,\n\t\t\ttimeoutMinutes,\n\t\t\tproxy,\n\t\t\tsolveCaptcha,\n\t\t\t...(extensionIds.length > 0 ? { extensionIds } : {}),\n\t\t},\n\t};\n\n\tconst { sessionId } = await createSession.call(this, body);\n\n\tif (saveProfileOnTermination) {\n\t\tawait apiRequest.call(\n\t\t\tthis,\n\t\t\t'PUT',\n\t\t\t`/sessions/${sessionId}/save-profile-on-termination/${profileName}`,\n\t\t);\n\t}\n\n\treturn this.helpers.returnJsonArray({ sessionId } as IDataObject);\n}\n"],"mappings":"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","names":[]}